<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"> 
        <title>小哈</title>
        <link rel="stylesheet" href="css/bootstrap.min.css">  
        <script src="js/jquery.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src='https://cdn.rawgit.com/naptha/tesseract.js/1.0.10/dist/tesseract.js'></script>
        <script src="js/md5.js"></script>
        <script src="js/similarity_config/similarity_config_head.js"></script>
        <script src="js/similarity_config/similarity_config_vie.js"></script>

        <script> 
            function translateResponse(data) {
                var translation_result = document.getElementById("translation_result");
                if(translation_result) {
                    var result = data.trans_result;
                    var dstArr = [];
                    for (var index = 0; index < result.length; index++) {
                        var element = result[index].dst;
                        dstArr.push(element);
                    }
                    translation_result.value = dstArr.join("\n");
                }
            }

            function translateRequest(str) {
                var appid = '2015063000000001';
                var key = '12345678';
                var salt = 19920913;
                var query = str;
                var from = 'auto';
                var to = 'zh';
                var str1 = appid + query + salt +key;
                var sign = MD5(str1);
                $.ajax({
                    url: 'https://fanyi-api.baidu.com/api/trans/vip/translate',
                    type: 'post',
                    dataType: 'jsonp',
                    data: {
                        q: query,
                        appid: appid,
                        salt: salt,
                        from: from,
                        to: to,
                        sign: sign
                    },
                    success: function (data) {
                        translateResponse(data);
                        console.log(data);
                    } 
                });
            }

            function onRecognizationChange(e) {
                translateRequest(e.srcElement.value);
            }

            window.onload = function(e) {
                var title1 = "请将截图粘贴到下方";
                var pasteArea_title = document.getElementById("pasteArea_title");
                console.log(pasteArea_title);

                document.addEventListener('paste', function (event) { 
                    var divElement = document.getElementById("pasteArea");
                    var img = divElement.getElementsByTagName("img")[0];
                    console.log(img);
                    if(img == null) {
                        img = document.createElement("img");
                    }
                    for (var index = 0; index < event.clipboardData.items.length; index++) {
                        var element = event.clipboardData.items[index];
                        if(element.type.indexOf("image") == -1) return;

                        var imgBlob = element.getAsFile();
                        img.src = window.URL.createObjectURL(imgBlob);
                        img.width = divElement.clientWidth - 30;
                        img.height = divElement.clientHeight - 30;
                        divElement.appendChild(img);

                        Tesseract.recognize(imgBlob, {
                                    lang: 'vie'
                                })
                                .progress(function(message){
                                    pasteArea_title.innerText = message.status + ":" + Number(message.progress).toFixed(2);
                                })
                                .catch(err => console.error(err))
                                .then(function(result){
                                    var element = document.getElementById("recognization_result");
                                    element.onkeyup = onRecognizationChange;
                                    if(element) {
                                        element.value = result.text;
                                        translateRequest(result.text);
                                    }
                                    pasteArea_title.innerText = title1;
                                })
                                .finally(resultOrError => console.log(resultOrError));
                    }
                });
            };
        </script>
    </head>

    <body>
        <div class="container" style="width:auto">
            <div class="row clearfix">
                <div class="col-lg-12 column">
                    <div class="jumbotron">
                        <h1>欢迎使用小哈！</h1>
                        <p>小哈暂时是一个图文转换+翻译的实用工具。</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row clearfix">
                <div class="col-md-6 column">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 id="pasteArea_title" class="panel-title">
                                请将截图粘贴到下方
                            </h3>
                        </div>
                        <div id="pasteArea" class="panel-body" style="height:300px">

                        </div>
                    </div>
                </div>
                <div class="col-md-6 column">
                    <form class="form-horizontal" role="form">
                        <div class="form-group">
                            <label for="inputEmail3">识别结果</label>
                            <textarea id="recognization_result" class="form-control" rows="6"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="inputEmail3">翻译结果</label>
                            <textarea id="translation_result" class="form-control" rows="6"></textarea>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row clearfix">
                <div class="col-md-12 column">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">
                                本地翻译库相似度匹配结果
                            </h3>
                        </div>
                        <div class="panel-body">
                            <div>
                                <p style="color:#000000">这里是外文这里是外文这里是外文这里是外文这里是外文这里是外文这里是外文</p>
                                <p style="color:#900000"><strong>这里是中文这里是中文这里是中文这里是中文这里是中文这里是中文这里是中文</strong></p>
                                <hr/>
                            </div>
                            <div>
                                <p style="color:#000000">这里是外文这里是外文这里是外文这里是外文这里是外文这里是外文这里是外文</p>
                                <p style="color:#900000"><strong>这里是中文这里是中文这里是中文这里是中文这里是中文这里是中文这里是中文</strong></p>
                            </div>
                        </div>
                        <div class="panel-footer">
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container" style="width:auto">
            <div class="row clearfix">
                <div class="col-lg-12 column">
                    <div class="jumbotron">
                        <h1>欢迎使用小哈！</h1>
                        <p>小哈暂时是一个图文转换+翻译的实用工具。</p>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>